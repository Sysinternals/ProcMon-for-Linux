# Azure build pipelines for Procmon-for-Linux

resources:
  repositories:
  - repository: Procmon
    type: github
    endpoint: sysinternals
    name: sysinternals/procmon-for-linux

trigger:
    branches:
      include:
        - release/*
        - main
      exclude:
        - dev/*
        - test/*
  
pr:
- main

stages:
 - stage: "Build"
   jobs:
    - job: "Build_Procmon"
      pool: "Procmon-Ubuntu-18.04-Pool"
      steps:
      - checkout: Procmon
      - script: |
          export REVISION=$(Build.BuildId)
          sed -i "s/999999/$REVISION/g" $(Build.SourcesDirectory)/CMakeLists.txt
          mkdir $(Build.SourcesDirectory)/build && cd $(Build.SourcesDirectory)/build
          cmake ..
          make
        displayName: "Build Procmon"